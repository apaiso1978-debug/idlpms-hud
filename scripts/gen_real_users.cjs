/**
 * gen_real_users.cjs — Generate real Wat Map Chalut users block for data.js
 * Outputs: scripts/real_users_block.js
 */
const fs = require('fs');
const path = require('path');

// Helper: initials from Thai name
function initials(name) {
    const parts = name.replace(/^(เด็กชาย|เด็กหญิง|นาย|นาง|นางสาว|ครู)/, '').trim().split(/\s+/);
    if (parts.length < 2) return parts[0]?.[0] || '?';
    return (parts[0][0] || '') + (parts[1][0] || '');
}

// CLASS MAP: [classId, gradeLevel]
const CLASS_INFO = {
    'อนุบาล 2': ['อนุบาล 2', 0], 'อนุบาล 3': ['อนุบาล 3', 0],
    'ป.1/1': ['ป.1/1', 1], 'ป.1/2': ['ป.1/2', 1],
    'ป.2/1': ['ป.2/1', 2], 'ป.2/2': ['ป.2/2', 2],
    'ป.3': ['ป.3', 3],
    'ป.4/1': ['ป.4/1', 4], 'ป.4/2': ['ป.4/2', 4],
    'ป.5/1': ['ป.5/1', 5], 'ป.5/2': ['ป.5/2', 5],
    'ป.6/1': ['ป.6/1', 6], 'ป.6/2': ['ป.6/2', 6],
};

// ================================================================
// TEACHERS (14 homeroom + 1 special)
// [key, fullName, homeroomClass, color]
// ================================================================
const TEACHERS = [
    ['TEA_M_01', 'นางนิติพร โฆเกียรติมานนท์', 'อนุบาล 2', 'sj-thai'],
    ['TEA_M_02', 'นางสุภาภรณ์ ชุ่มแอ่น', 'อนุบาล 3', 'sj-math'],
    ['TEA_M_03', 'นางสาวรัตนาวลี ทิศเสถียร', 'ป.1/1', 'sj-sci'],
    ['TEA_M_04', 'นางสาวริศรา แก้วเคน', 'ป.1/2', 'sj-soc'],
    ['TEA_M_05', 'นางสาววาสนา ปะทะนมปีย์', 'ป.2/1', 'sj-pe'],
    ['TEA_M_06', 'นางสาวพิมพร สาตรา', 'ป.2/2', 'sj-art'],
    ['TEA_M_07', 'นางสาวเจนจิรา มั่นหมาย', 'ป.3', 'sj-eng'],
    ['TEA_M_08', 'นางสาวสุนิษา สองสี', 'ป.3', 'sj-thai'],  // co-homeroom
    ['TEA_M_09', 'นายณัฐนนท์ มหาเสน', 'ป.4/1', 'sj-math'],
    ['TEA_M_10', 'นางสาววิชุดา บุญเฟรือง', 'ป.4/2', 'sj-sci'],
    ['TEA_M_11', 'นายธิติพงศ์ ขจรภพ', 'ป.4/2', 'sj-soc'],  // co-homeroom
    ['TEA_M_12', 'นายภานุวัฒน์ สุวรรณมาโจ', 'ป.5/1', 'sj-pe'],
    ['TEA_M_13', 'นายยุทธนา คุณอุตส่าห์', 'ป.5/2', 'sj-art'],
    ['TEA_M_14', 'นายวุฒิไกร ปุรินัย', 'ป.6/1', 'sj-eng'],
    ['TEA_M_15', 'นางสาวแพรวพรรณ สมพงษ์', 'ป.6/2', 'sj-thai'],
];

// ================================================================
// STUDENTS — compact [code, cid, name, dob, note]
// Grouped by class
// ================================================================
const STUDENTS = {
    'อนุบาล 2': [
        ["6703", "1219700139677", "เด็กชายกิตติพงษ์ อินทรฉ่ำ", "12 มิ.ย. 2562", ""],
        ["6704", "1200901996846", "เด็กชายฉัตรชนก สนิทแสง", "8 พ.ค. 2564", ""],
        ["6705", "1219901813481", "เด็กชายชนะศักดิ์ พรมทัต", "18 พ.ค. 2563", ""],
        ["6706", "1209001194661", "เด็กชายฐาปกรณ์ รัตนวาร", "16 เม.ย. 2563", ""],
        ["6707", "1219901821114", "เด็กชายไตรนรินทร์ จันทร์ดากุล", "28 ก.ค. 2563", "ย้ายออก"],
        ["6708", "1209301371223", "เด็กชายธนกร บุญเทศ", "27 ก.ย. 2563", ""],
        ["6709", "1219700165953", "เด็กชายธนกฤต เจริญรัตน์", "23 เม.ย. 2564", ""],
        ["6710", "1219700157144", "เด็กชายธนภัทร ใจตา", "29 ก.ค. 2563", "ย้ายออก"],
        ["6711", "1209301368087", "เด็กชายวราศัย สุวรรณปักษิณ", "17 มิ.ย. 2563", ""],
        ["6712", "1219700157799", "เด็กหญิงกัญญ์จิรา บริบุญวงศ์", "13 ส.ค. 2563", ""],
        ["6713", "1208400018288", "เด็กหญิงขนมหวาน ดอกไม้ขาว", "28 พ.ค. 2563", ""],
        ["6714", "1219700160544", "เด็กหญิงชุติกาญจน์ สุขศรี", "30 ต.ค. 2563", ""],
        ["6715", "1219700161362", "เด็กหญิงณัชชา แก้วลือชา", "18 พ.ย. 2563", ""],
        ["6716", "1200901983701", "เด็กหญิงภัทรพร กองดี", "23 พ.ย. 2563", ""],
        ["6717", "1200901983086", "เด็กหญิงวรรณภา ไชยเดช", "25 พ.ย. 2563", ""],
        ["6718", "1249901318439", "เด็กหญิงมีบุญ ศรีวิรัตน์", "30 เม.ย. 2564", ""],
        ["6719", "1849903036117", "เด็กหญิงเขมิสรา มีอยู่สามเสน", "11 ก.พ. 2564", "ย้ายออก"],
        ["6720", "1219700162041", "เด็กหญิงณัฐนภา สำเภาเงิน", "12 ธ.ค. 2563", ""],
        ["6721", "0021981062866", "เด็กชายระยอง โอม", "2 ส.ค. 2563", ""],
        ["6738", "1219700159082", "เด็กชายกฤติเดช บุญเจริญ", "17 ก.ย. 2563", "ย้ายออก"],
        ["6749", "1219400087272", "เด็กชายศุภวัฒน์ สนตะเถน", "17 เม.ย. 2564", "ย้ายออก"],
        ["6729", "1139600970456", "เด็กชายวีรภัทร อุฤทธิ์", "10 มิ.ย. 2563", ""],
        ["6641", "0021971114499", "เด็กชายชานนท์", "27 พ.ย. 2562", ""],
        ["6752", "G682100012627", "เด็กหญิงมะนะเวเนียนโม", "13 ธ.ค. 2561", ""],
        ["6756", "1349902351315", "เด็กหญิงสุรัตน์ดา ลดุลพันธ์", "13 ก.ย. 2563", "ย้ายออก"],
        ["6760", "1209602176144", "เด็กหญิงสุธาสินี ดวงแก้ว", "6 ก.พ. 2564", ""],
        ["6768", "1219901846575", "เด็กหญิงปทิตา แก้วนิ่ม", "23 มี.ค. 2564", ""],
        ["6770", "1219700159503", "เด็กหญิงณัฏณิชา ซาเฟื้อย", "28 ก.ย. 2563", ""],
        ["", "0021971126250", "เด็กชายดิน", "27 พ.ค. 2564", "อายุไม่ถึงเกณฑ์"],
        ["", "1219901857267", "เด็กหญิงศริญญา สุขราช", "5 ก.ค. 2564", "อายุไม่ถึงเกณฑ์"],
    ],
    'อนุบาล 3': [
        ["6635", "1219901771753", "เด็กชายณัฐสุพัฒน์ สุพล", "14 พ.ค. 2562", ""],
        ["6637", "1200901944986", "เด็กชายกรวีร์ อินทอง", "26 ก.ย. 2562", ""],
        ["6638", "1219700149249", "เด็กชายนิธิพงศ์ ศรีสกล", "13 ม.ค. 2563", "ย้ายออก"],
        ["6639", "1219901775741", "เด็กชายไมยราพ พรมเสน", "17 มิ.ย. 2562", ""],
        ["6645", "1219700143861", "เด็กหญิงรัตนากร ทองแสน", "23 ก.ย. 2562", ""],
        ["6647", "1200901965452", "เด็กชายฐิติพัชร สุวรรณโชติ", "7 พ.ค. 2563", ""],
        ["6648", "1219700139944", "เด็กหญิงปิยะดา สาริยง", "20 มิ.ย. 2562", ""],
        ["6649", "1219700144999", "เด็กหญิงรัดเกล้า สวัสดิ์แสน", "11 ต.ค. 2562", ""],
        ["6650", "1200901942037", "เด็กหญิงนิรดา วรรณโคตร", "24 ต.ค. 2562", ""],
        ["6651", "1332000045761", "เด็กหญิงอริสรา พิลากรณ์", "8 พ.ย. 2562", "ย้ายออก"],
        ["6652", "1219700147564", "เด็กหญิงลลิล ประเสริฐศิลป์", "6 ธ.ค. 2562", ""],
        ["6655", "1249901268008", "เด็กหญิงนิระดา วันทะวงษ์", "19 ก.ค. 2562", "ย้ายออก"],
        ["6656", "1200901961872", "เด็กหญิงภาวิดา สุกรา", "1 เม.ย. 2563", ""],
        ["6657", "1339100169868", "เด็กหญิงธนพร ศรีราทา", "20 ม.ค. 2563", ""],
        ["6683", "1219700147866", "เด็กหญิงชลธิชา มณีรัตน์", "13 ธ.ค. 2562", ""],
        ["6685", "1347900063531", "เด็กหญิงชลิตา กายยาคำ", "27 ม.ค. 2562", "ย้ายออก"],
        ["6691", "1219700154196", "เด็กชายภูษิต วงเวียน", "15 พ.ค. 2563", ""],
        ["6692", "1729901154849", "เด็กชายสงกรานต์ โสภา", "17 เม.ย. 2562", ""],
        ["6696", "1219700146240", "เด็กหญิงรัตนกร นาหัวนิล", "8 พ.ย. 2562", ""],
        ["6697", "1218700072261", "เด็กชายชนาธิป รักกลาง", "27 มิ.ย. 2562", "ย้ายออก"],
        ["6723", "1200901950846", "เด็กชายสุรธัช ยอดขาว", "23 พ.ย. 2562", ""],
        ["6724", "1567700170952", "เด็กชายกิตติพัฒน์ ดียางหวาย", "22 ก.พ. 2563", "ย้ายออก"],
        ["6739", "1348600118919", "เด็กชายอาทิตย์ สุจะวี", "29 ธ.ค. 2562", ""],
        ["6744", "1638900122200", "เด็กชายอชิตพล ทรงกิตติกุล", "9 พ.ย. 2562", "ย้ายออก"],
        ["6722", "1639800611552", "เด็กหญิงมลฤดี อยู่ลือ", "1 ส.ค. 2562", ""],
        ["6764", "1219700144166", "เด็กหญิงฐานิดา แจ่มผล", "27 ก.ย. 2562", ""],
    ],
};

// We'll write remaining classes to a second file to keep this manageable
// For now generate Part 1 (K2, K3 + staff) then Part 2 for primary

let lines = [];

// ========== PRINCIPAL ==========
lines.push(`        // ═══ โรงเรียนวัดมาบชลูด — ข้อมูลจริง ปีการศึกษา 2568 ═══`);
lines.push(`        // ═══ ผู้อำนวยการ ═══`);
lines.push(`        DIR_MABLUD: {`);
lines.push(`            role: 'SCHOOL_DIR',`);
lines.push(`            fullName: 'นายบุญเรือง ถ้ำมณี',`);
lines.push(`            name: 'ผอ.โรงเรียนวัดมาบชลูด',`);
lines.push(`            org: 'โรงเรียนวัดมาบชลูด สพป.ระยอง เขต 1',`);
lines.push(`            schoolId: 'SCH_MABLUD',`);
lines.push(`            districtId: 'ESA_01',`);
lines.push(`            avatar: 'BT',`);
lines.push(`            color: 'id-dir',`);
lines.push(`            status: 'ONLINE',`);
lines.push(`        },`);

// ========== SPECIAL TEACHER: WORACHAI ==========
lines.push(`        // ═══ ครูพิเศษ / Developer / Admin / Founder ═══`);
lines.push(`        TEA_WORACHAI: {`);
lines.push(`            role: 'TEACHER',`);
lines.push(`            fullName: 'นายวรชัย อภัยโส',`);
lines.push(`            schoolId: 'SCH_MABLUD',`);
lines.push(`            avatar: 'WA',`);
lines.push(`            color: 'id-dir',`);
lines.push(`            specialRoles: ['SPECIAL_TEACHER', 'DEVELOPER', 'ADMIN', 'FOUNDER'],`);
lines.push(`            email: 'Apaiso1978@gmail.com',`);
lines.push(`            credentials: { email: 'Apaiso1978@gmail.com', password: 'Yuri@04032526' },`);
lines.push(`            canTeachSubjects: ['ICT', 'SCI', 'SCI_PLUS', 'GUIDE', 'SCOUT', 'PRAY', 'RILS', 'SOCIAL', 'CLUB', 'PLC'],`);
lines.push(`            maxPeriodsPerDay: 6, maxPeriodsPerWeek: 25,`);
lines.push(`            workloadRoles: ['system_admin', 'developer', 'founder'],`);
lines.push(`            status: 'ONLINE',`);
lines.push(`        },`);

// ========== HOMEROOM TEACHERS ==========
lines.push(`        // ═══ ครูประจำชั้น (14 คน) ═══`);
for (const [key, name, homeroom, color] of TEACHERS) {
    const av = initials(name);
    lines.push(`        ${key}: {`);
    lines.push(`            role: 'TEACHER', fullName: '${name}', schoolId: 'SCH_MABLUD', avatar: '${av}', color: '${color}',`);
    lines.push(`            homeroomClass: '${homeroom}', maxPeriodsPerDay: 6, maxPeriodsPerWeek: 25,`);
    lines.push(`            canTeachSubjects: ['GUIDE', 'SCOUT', 'PRAY', 'RILS', 'SOCIAL', 'CLUB', 'PLC'],`);
    lines.push(`            workloadRoles: ['homeroom'],`);
    lines.push(`        },`);
}

// ========== STUDENTS ==========
let stuIdx = 0;
for (const [className, students] of Object.entries(STUDENTS)) {
    const [classId, grade] = CLASS_INFO[className];
    lines.push(`        // ═══ ${className} (${students.length} คน) ═══`);
    for (const [code, cid, name, dob, note] of students) {
        stuIdx++;
        const key = `STU_M_${String(stuIdx).padStart(3, '0')}`;
        const av = initials(name);
        const isActive = !note.includes('ย้ายออก');
        lines.push(`        ${key}: { role: 'STUDENT', fullName: '${name}', schoolId: 'SCH_MABLUD', classId: '${classId}', gradeLevel: ${grade}, avatar: '${av}', color: 'cyan', insforgeStudentCode: '${code}', citizenId: '${cid}'${!isActive ? ", status: 'WITHDRAWN'" : ''} },`);
    }
}

// Write output
const output = lines.join('\n');
const outPath = path.join(__dirname, 'real_users_block_part1.txt');
fs.writeFileSync(outPath, output, 'utf-8');
console.log(`Written ${lines.length} lines to ${outPath}`);
console.log(`Students so far: ${stuIdx}`);
